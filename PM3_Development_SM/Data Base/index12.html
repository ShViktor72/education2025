<!doctype html>
<html>
  <head>
    <title>–ú–æ–π –ø—Ä–æ–µ–∫—Ç —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π</title>
    <style>
      /* –°—Ç–∏–ª–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ */
      .hidden {
        display: none;
      }
      .auth-form {
        background: #f5f5f5;
        padding: 20px;
        margin: 20px auto;
        max-width: 400px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .auth-form input {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
      }
      .auth-form button {
        background: #4285f4;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .auth-form button:hover {
        background: #3367d6;
      }
      .error {
        color: #d93025;
        background: #fce8e6;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .user-info {
        background: #e8f0fe;
        padding: 15px;
        margin: 20px 0;
        border-radius: 10px;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #ddd;
        margin-bottom: 20px;
      }
      .auth-btn {
        background: #4285f4;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-left: 10px;
      }
      .logout-btn {
        background: #ea4335;
      }
      .welcome {
        color: #1a73e8;
        font-weight: bold;
      }
      .success {
        color: #188038;
        background: #e6f4ea;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
      .admin-form {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: #f9f9f9;
      }

      .admin-form h4 {
        margin: 0 0 15px 0;
        color: #333;
      }

      .admin-input {
        width: 100%;
        padding: 8px;
        margin: 5px 0;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 14px;
      }

      .admin-input:focus {
        outline: none;
        border-color: #4285f4;
        box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
      }

      .admin-btn {
        background: #34a853;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        margin-top: 10px;
        transition: background 0.2s;
      }

      .admin-btn:hover {
        background: #2d9249;
      }

      .admin-btn:active {
        background: #267c3e;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ */
      .product-item {
        border: 1px solid #ddd;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        background: white;
      }

      .product-item h3 {
        margin: 0 0 10px 0;
        color: #1a73e8;
      }

      .delete-btn {
        background: #ea4335;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 13px;
        margin-top: 10px;
        transition: background 0.2s;
      }

      .delete-btn:hover {
        background: #d93025;
      }

      .delete-btn:active {
        background: #c5221f;
      }
    </style>
  </head>
  <body>
    <!-- –®–∞–ø–∫–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div class="header">
      <h1>–¢–æ–≤–∞—Ä—ã –∏–∑ Firebase</h1>
      <div id="auth-controls">
        <span id="welcome-message" class="welcome hidden"></span>
        <button id="show-auth-btn" class="auth-btn">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <button id="logout-btn" class="auth-btn logout-btn hidden">
          –í—ã–π—Ç–∏
        </button>
      </div>
    </div>

    <!-- –§–æ—Ä–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç—ã) -->
    <div id="auth-container" class="auth-form hidden">
      <h3 id="auth-title">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>

      <input type="email" id="auth-email" placeholder="–í–∞—à email" />
      <input
        type="password"
        id="auth-password"
        placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)"
      />

      <div id="auth-error" class="error hidden"></div>
      <div id="auth-success" class="success hidden"></div>

      <button id="signin-btn">–í–æ–π—Ç–∏</button>
      <button id="signup-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      <button id="cancel-auth-btn">–û—Ç–º–µ–Ω–∞</button>
    </div>

    <!-- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) -->
    <div id="user-profile" class="user-info hidden">
      <h3>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h3>
      <p><strong>Email:</strong> <span id="user-email"></span></p>
      <p><strong>ID:</strong> <span id="user-id"></span></p>
      <p><strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> <span id="user-created"></span></p>
      <p><strong>–†–æ–ª—å:</strong> <span id="user-role"></span></p>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div id="admin-controls" class="hidden">
    <h3>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
    
    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
        <div class="admin-form">
            <h4>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h4>
            <input type="text" id="new-product-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" class="admin-input">
            <input type="number" id="new-product-price" placeholder="–¶–µ–Ω–∞" step="0.01" class="admin-input">
            <button id="add-product-btn" class="admin-btn">
            –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
            </button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Ç–æ–≤–∞—Ä—ã) -->
    <div id="output">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase SDK —á–µ—Ä–µ–∑ CDN -->
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>
    <!-- –î–û–ë–ê–í–õ–ï–ù–û: Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>

    <script>
      // 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—é!)

      const firebaseConfig = {
        apiKey: "",
        authDomain: "",
        projectId: "",
        storageBucket: "",
        messagingSenderId: "",
        appId: "",
      };

      // 2. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE
      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const auth = firebase.auth(); // <-- –î–û–ë–ê–í–õ–ï–ù–û: –æ–±—ä–µ–∫—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

      console.log("Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!");

      // 3. –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø UI
      const authContainer = document.getElementById("auth-container");
      const showAuthBtn = document.getElementById("show-auth-btn");
      const logoutBtn = document.getElementById("logout-btn");
      const welcomeMessage = document.getElementById("welcome-message");
      const userProfile = document.getElementById("user-profile");
      const output = document.getElementById("output");

      // 13. –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
      const adminControls = document.getElementById("admin-controls");
      let currentUserRole = "user";

      // 4. –ü–û–ö–ê–ó–ê–¢–¨/–°–ö–†–´–¢–¨ –°–û–û–ë–©–ï–ù–ò–Ø
      function showError(message) {
        const errorDiv = document.getElementById("auth-error");
        errorDiv.textContent = message;
        errorDiv.classList.remove("hidden");
        document.getElementById("auth-success").classList.add("hidden");
      }

      function showSuccess(message) {
        const successDiv = document.getElementById("auth-success");
        successDiv.textContent = message;
        successDiv.classList.remove("hidden");
        document.getElementById("auth-error").classList.add("hidden");
      }

      function hideMessages() {
        document.getElementById("auth-error").classList.add("hidden");
        document.getElementById("auth-success").classList.add("hidden");
      }

      // 5. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
      async function registerUser(email, password) {
        hideMessages();

        try {
          // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firebase Authentication
          const userCredential = await auth.createUserWithEmailAndPassword(
            email,
            password,
          );
          const user = userCredential.user;

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Firestore
          await db.collection("users").doc(user.uid).set({
            email: user.email,
            displayName: "", // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏
            createdAt: new Date().toISOString(),
            role: "user", // –†–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            lastLogin: new Date().toISOString(),
          });

          showSuccess("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");
          console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:", user.email);

          // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
          document.getElementById("auth-email").value = "";
          document.getElementById("auth-password").value = "";
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:", error.code);

          // –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
          switch (error.code) {
            case "auth/email-already-in-use":
              showError("–≠—Ç–æ—Ç email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è");
              break;
            case "auth/invalid-email":
              showError("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email");
              break;
            case "auth/weak-password":
              showError("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤");
              break;
            default:
              showError("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: " + error.message);
          }
        }
      }

      // 6. –í–•–û–î –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
      async function loginUser(email, password) {
        hideMessages();

        try {
          const userCredential = await auth.signInWithEmailAndPassword(
            email,
            password,
          );
          const user = userCredential.user;

          // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
          await db.collection("users").doc(user.uid).update({
            lastLogin: new Date().toISOString(),
          });

          showSuccess("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
          console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª:", user.email);

          // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
          document.getElementById("auth-email").value = "";
          document.getElementById("auth-password").value = "";
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error.code);

          switch (error.code) {
            case "auth/user-not-found":
              showError("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
              break;
            case "auth/wrong-password":
              showError("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
              break;
            case "auth/invalid-email":
              showError("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email");
              break;
            case "auth/user-disabled":
              showError("–ê–∫–∫–∞—É–Ω—Ç –æ—Ç–∫–ª—é—á–µ–Ω");
              break;
            default:
              showError("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: " + error.message);
          }
        }
      }

      // 7. –í–´–•–û–î –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
      async function logoutUser() {
        try {
          await auth.signOut();
          console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª");
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", error);
          showError("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã");
        }
      }

      // 8. –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
      auth.onAuthStateChanged(async (user) => {
        console.log(
          "–°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:",
          user ? user.email : "null",
        );

        if (user) {
          // –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –í–û–®–ï–õ
          updateUIForLoggedInUser(user);

          // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –∏–∑ Firestore
          try {
            const userDoc = await db.collection("users").doc(user.uid).get();
            if (userDoc.exists) {
              const userData = userDoc.data();
              updateUserProfileUI(user, userData);
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:", error);
          }
        } else {
          // –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –í–´–®–ï–õ –ò–õ–ò –ù–ï –ê–í–¢–û–†–ò–ó–û–í–ê–ù
          updateUIForGuest();
        }

        // –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã (–∏ –¥–ª—è –≥–æ—Å—Ç–µ–π —Ç–æ–∂–µ)
        loadProducts();
      });

      // 9. –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê
      async function updateUIForLoggedInUser(user) {
        // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–ø–∫—É
        welcomeMessage.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.email.split("@")[0]}!`;
        welcomeMessage.classList.remove("hidden");
        showAuthBtn.classList.add("hidden");
        logoutBtn.classList.remove("hidden");

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
        userProfile.classList.remove("hidden");

        // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        authContainer.classList.add("hidden");

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        currentUserRole = await checkUserRole(user.uid);

        // –ï—Å–ª–∏ –∞–¥–º–∏–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å, –∏–Ω–∞—á–µ - —Å–∫—Ä—ã–≤–∞–µ–º
        if (currentUserRole === "admin") {
          adminControls.classList.remove("hidden");
          document.getElementById("user-role").textContent = "üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä";
        } else {
          adminControls.classList.add("hidden"); // ‚Üê –î–û–ë–ê–í–ò–¢–¨ –≠–¢–£ –°–¢–†–û–ö–£
          document.getElementById("user-role").textContent = "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
        }
      }

      function updateUIForGuest() {
        // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–ø–∫—É
        welcomeMessage.classList.add("hidden");
        showAuthBtn.classList.remove("hidden");
        logoutBtn.classList.add("hidden");

        // –°–∫—Ä—ã–≤–∞–µ–º –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
        userProfile.classList.add("hidden");

        // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        authContainer.classList.add("hidden");

        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
        document.getElementById("auth-email").value = "";
        document.getElementById("auth-password").value = "";
        hideMessages();
      }

      function updateUserProfileUI(user, userData) {
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
        document.getElementById("user-email").textContent = user.email;
        document.getElementById("user-id").textContent = user.uid;

        if (userData.createdAt) {
          const date = new Date(userData.createdAt);
          document.getElementById("user-created").textContent =
            date.toLocaleDateString("ru-RU");
        }

        document.getElementById("user-role").textContent =
          userData.role || "user";
      }

      // 10. –ó–ê–ì–†–£–ó–ö–ê –¢–û–í–ê–†–û–í
      function loadProducts() {
        output.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...";

        db.collection("products")
          .get()
          .then((snapshot) => {
            output.innerHTML = "";

            if (snapshot.empty) {
              output.innerHTML = "<p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>";
              return;
            }

            snapshot.forEach((doc) => {
              const data = doc.data();
              const productId = doc.id;

              // –°–æ–∑–¥–∞–µ–º –±–ª–æ–∫ —Ç–æ–≤–∞—Ä–∞
              const productDiv = document.createElement("div");
              productDiv.className = "product-item";
              productDiv.style.border = "1px solid #ddd";
              productDiv.style.padding = "15px";
              productDiv.style.margin = "10px 0";
              productDiv.style.borderRadius = "5px";

              // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
              productDiv.innerHTML = `
                <h3 style="margin: 0 0 10px 0;">${data.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}</h3>
                <p style="margin: 5px 0;"><strong>–¶–µ–Ω–∞:</strong> $${data.price || "0"}</p>
                <p style="margin: 5px 0; color: #666; font-size: 14px;">
                    –î–æ–±–∞–≤–ª–µ–Ω: ${data.createdBy || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}
                </p>
                `;

              // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
              if (currentUserRole === "admin") {
                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "–£–¥–∞–ª–∏—Ç—å";
                deleteBtn.style.background = "#ea4335";
                deleteBtn.style.color = "white";
                deleteBtn.style.border = "none";
                deleteBtn.style.padding = "5px 10px";
                deleteBtn.style.borderRadius = "3px";
                deleteBtn.style.cursor = "pointer";
                deleteBtn.style.marginTop = "10px";
                deleteBtn.onclick = function () {
                  deleteProduct(productId);
                };

                productDiv.appendChild(deleteBtn);
              }

              output.appendChild(productDiv);
            });
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:", error);
            output.innerHTML =
              '<p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>';
          });
      }

      // 11. –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
      // –ö–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
      showAuthBtn.addEventListener("click", () => {
        authContainer.classList.remove("hidden");
        hideMessages();
      });

      // –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" –≤ —Ñ–æ—Ä–º–µ
      document
        .getElementById("cancel-auth-btn")
        .addEventListener("click", () => {
          authContainer.classList.add("hidden");
          hideMessages();
        });

      // –ö–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏"
      document.getElementById("signin-btn").addEventListener("click", () => {
        const email = document.getElementById("auth-email").value;
        const password = document.getElementById("auth-password").value;

        if (!email || !password) {
          showError("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å");
          return;
        }

        loginUser(email, password);
      });

      // –ö–Ω–æ–ø–∫–∞ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"
      document.getElementById("signup-btn").addEventListener("click", () => {
        const email = document.getElementById("auth-email").value;
        const password = document.getElementById("auth-password").value;

        if (!email || !password) {
          showError("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å");
          return;
        }

        if (password.length < 6) {
          showError("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤");
          return;
        }

        registerUser(email, password);
      });

      // –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏"
      logoutBtn.addEventListener("click", logoutUser);

      // –ù–∞–∂–∞—Ç–∏–µ Enter –≤ –ø–æ–ª—è—Ö —Ñ–æ—Ä–º—ã
      document
        .getElementById("auth-password")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            const email = document.getElementById("auth-email").value;
            const password = document.getElementById("auth-password").value;
            loginUser(email, password);
          }
        });

      // 14. –§–£–ù–ö–¶–ò–Ø –ü–†–û–í–ï–†–ö–ò –†–û–õ–ò
      async function checkUserRole(userId) {
        try {
          const userDoc = await db.collection("users").doc(userId).get();
          if (userDoc.exists) {
            return userDoc.data().role || "user";
          }
          return "user";
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏:", error);
          return "user";
        }
      }

      // 16. –§–£–ù–ö–¶–ò–Ø –î–û–ë–ê–í–õ–ï–ù–ò–Ø –¢–û–í–ê–†–ê
      async function addProduct() {
        const name = document.getElementById("new-product-name").value.trim();
        const price = document.getElementById("new-product-price").value;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞
        if (!name || !price) {
          alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞");
          return;
        }

        if (parseFloat(price) <= 0) {
          alert("–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0");
          return;
        }

        try {
          // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤ Firestore
          await db.collection("products").add({
            name: name,
            price: parseFloat(price),
            createdAt: new Date().toISOString(),
            createdBy: firebase.auth().currentUser.email,
          });

          alert("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!");

          // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
          document.getElementById("new-product-name").value = "";
          document.getElementById("new-product-price").value = "";

          // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
          loadProducts();
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:", error);
          alert("–û—à–∏–±–∫–∞: " + error.message);
        }
      }

      // 18. –§–£–ù–ö–¶–ò–Ø –£–î–ê–õ–ï–ù–ò–Ø –¢–û–í–ê–†–ê
      async function deleteProduct(productId) {
        if (currentUserRole !== "admin") {
          alert("–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ç–æ–≤–∞—Ä—ã");
          return;
        }

        if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?")) {
          return;
        }

        try {
          await db.collection("products").doc(productId).delete();
          alert("–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω");
          loadProducts(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:", error);
          alert("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞");
        }
      }

      // 19. –û–ë–†–ê–ë–û–¢–ß–ò–ö –°–û–ë–´–¢–ò–ô –î–õ–Ø –ö–ù–û–ü–ö–ò –î–û–ë–ê–í–õ–ï–ù–ò–Ø
      document
        .getElementById("add-product-btn")
        .addEventListener("click", addProduct);

      // –¢–∞–∫–∂–µ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter –≤ –ø–æ–ª–µ —Ü–µ–Ω—ã
      document
        .getElementById("new-product-price")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            addProduct();
          }
        });

      // 12. –ó–ê–ì–†–£–ó–ö–ê –¢–û–í–ê–†–û–í –ü–†–ò –°–¢–ê–†–¢–ï
      document.addEventListener("DOMContentLoaded", () => {
        console.log("–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞");
        loadProducts();
      });
    </script>
  </body>
</html>
